---
phase: 03-master-profile-management
plan: 04
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - frontend/app/profile/components/experience/ExperienceSection.tsx
  - frontend/app/profile/components/experience/ExperienceCard.tsx
  - frontend/app/profile/components/experience/ExperienceFormDialog.tsx
  - frontend/app/profile/components/experience/BulletPointList.tsx
  - frontend/app/profile/components/experience/SortableExperienceList.tsx
  - frontend/app/profile/components/shared/DeleteConfirmDialog.tsx
  - frontend/app/profile/components/shared/SortableItem.tsx
autonomous: true

must_haves:
  truths:
    - "User sees summary cards for each work experience entry showing job title, company, dates"
    - "User can click Add to open a modal form for new work experience"
    - "User can click Edit on a card to open modal with pre-filled data"
    - "Modal form has separate text fields for each bullet point with + Add achievement button"
    - "User can drag-and-drop to reorder experience cards using grip handle"
    - "User can drag-and-drop to reorder bullet points within a job"
    - "User can delete a work experience entry with confirmation dialog"
    - "Empty state shows message and add button when no experiences exist"
  artifacts:
    - path: "frontend/app/profile/components/experience/ExperienceSection.tsx"
      provides: "Main experience section with list, add button, empty state"
      min_lines: 30
    - path: "frontend/app/profile/components/experience/ExperienceCard.tsx"
      provides: "Summary card with job title, company, dates, truncated bullets"
      min_lines: 30
    - path: "frontend/app/profile/components/experience/ExperienceFormDialog.tsx"
      provides: "Modal form for add/edit experience with bullet points"
      contains: "workExperienceSchema"
    - path: "frontend/app/profile/components/experience/BulletPointList.tsx"
      provides: "Dynamic list of bullet point text fields with add/remove/reorder"
      contains: "useFieldArray"
    - path: "frontend/app/profile/components/experience/SortableExperienceList.tsx"
      provides: "Drag-and-drop wrapper for experience cards"
      contains: "DndContext"
  key_links:
    - from: "frontend/app/profile/components/experience/ExperienceFormDialog.tsx"
      to: "frontend/lib/profile-api.ts"
      via: "profileAPI.addExperience or updateExperience on submit"
      pattern: "profileAPI\\.(addExperience|updateExperience)"
    - from: "frontend/app/profile/components/experience/SortableExperienceList.tsx"
      to: "frontend/lib/profile-api.ts"
      via: "profileAPI.reorderSection on drag end"
      pattern: "profileAPI\\.reorderSection"
    - from: "frontend/app/profile/components/experience/ExperienceFormDialog.tsx"
      to: "frontend/lib/validations/profile.ts"
      via: "zodResolver with workExperienceSchema"
      pattern: "workExperienceSchema"
---

<objective>
Build the complete Work Experience section with summary cards, modal add/edit form with bullet points, drag-and-drop reordering for both jobs and bullet points, and delete confirmation.

Purpose: Work Experience is the most complex profile section (modals, nested bullet points, drag-and-drop at two levels). Building it establishes patterns that simpler sections will follow.
Output: Fully interactive Work Experience section with CRUD operations, drag-and-drop reordering, and empty state handling.
</objective>

<execution_context>
@C:\Users\pc\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pc\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-master-profile-management/03-CONTEXT.md
@.planning/phases/03-master-profile-management/03-RESEARCH.md
@.planning/phases/03-master-profile-management/03-01-SUMMARY.md
@.planning/phases/03-master-profile-management/03-02-SUMMARY.md
@frontend/lib/validations/profile.ts
@frontend/lib/profile-api.ts
@frontend/types/profile.ts
@frontend/components/ui/dialog.tsx
@frontend/components/ui/form.tsx
@frontend/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build ExperienceCard, ExperienceFormDialog with bullet points, and DeleteConfirmDialog</name>
  <files>
    frontend/app/profile/components/experience/ExperienceCard.tsx
    frontend/app/profile/components/experience/ExperienceFormDialog.tsx
    frontend/app/profile/components/experience/BulletPointList.tsx
    frontend/app/profile/components/shared/DeleteConfirmDialog.tsx
  </files>
  <action>
**ExperienceCard.tsx** - Summary display card per user decision:
- Shows: job title (bold), company name, date range (formatted with date-fns, e.g., "Jan 2022 - Present")
- Shows first 2-3 bullet points with "...more" expansion link (toggles to show all)
- Location shown if present (subtle/muted text)
- Action buttons: "Edit" (opens modal), "Delete" (opens confirm dialog)
- Drag handle icon (six-dot grip ⋮⋮) on the left side for reordering
- Use Tailwind classes: card with border, padding, rounded corners, subtle shadow on hover

**ExperienceFormDialog.tsx** - Modal form per user decision (add/edit in modal overlay):
- Uses shadcn/ui Dialog component
- React Hook Form with zodResolver(workExperienceSchema)
- When editing: pre-populate from passed `experience` prop
- When adding: empty defaults with one blank bullet point

Form fields:
1. Job Title (text input, required)
2. Company (text input, required)
3. Location (text input, optional, placeholder: "e.g., Johannesburg, South Africa")
4. Start Date (month/year input - use type="month" or two selects)
5. End Date (month/year input, disabled when "Current" is checked)
6. Current Position (checkbox - when checked, clear endDate and disable it)
7. Bullet Points section - rendered by BulletPointList component

Dialog footer: Cancel button (closes dialog) + Save button (submits form, shows loading state)

On submit:
- If editing (has experience.id): call `profileAPI.updateExperience(id, data)`
- If adding: call `profileAPI.addExperience(data)`
- On success: call `onSave()` callback (parent refreshes list), close dialog
- On error: show error via `form.setError('root', ...)`, keep dialog open

Dialog should be scrollable if content overflows (max-h-[90vh] overflow-y-auto per research example).

**BulletPointList.tsx** - Dynamic bullet point fields per user decision:
- Uses React Hook Form's `useFieldArray` for dynamic fields
- Each bullet point is a separate text field (textarea for multi-line)
- "+" Add Achievement button below the list (calls `append({ text: '' })`)
- Remove button (X icon) on each bullet point (calls `remove(index)`)
- Drag handles (⋮⋮) on each bullet point for reordering within the job
- Use dnd-kit SortableContext for bullet point drag-and-drop
- CRITICAL: Use `field.id` as React key, NOT index (per research anti-pattern warning)
- Minimum 1 bullet point (validation schema enforces this)
- When only 1 bullet point remains, hide the remove button

**DeleteConfirmDialog.tsx** - Reusable confirmation dialog (Claude's discretion on design):
- Uses shadcn/ui Dialog
- Title: "Delete {itemType}?"
- Description: "This action cannot be undone. This will permanently delete this {itemType} from your profile."
- Two buttons: "Cancel" (closes) and "Delete" (destructive/red, calls onConfirm)
- Loading state on Delete button while API call is in progress
- Props: open, onOpenChange, onConfirm, itemType (string), itemName (string, optional for display)
  </action>
  <verify>
1. ExperienceCard renders with title, company, dates, and truncated bullets
2. Clicking Edit opens dialog with pre-filled form
3. BulletPointList allows adding/removing bullet points dynamically
4. Form validation shows errors for empty required fields
5. DeleteConfirmDialog opens with correct messaging
6. No TypeScript compilation errors
  </verify>
  <done>
ExperienceCard displays summary with truncation. ExperienceFormDialog handles add/edit with bullet point management via useFieldArray. BulletPointList supports dynamic add/remove with drag handles. DeleteConfirmDialog is reusable for all sections.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build SortableExperienceList, ExperienceSection, and shared SortableItem</name>
  <files>
    frontend/app/profile/components/shared/SortableItem.tsx
    frontend/app/profile/components/experience/SortableExperienceList.tsx
    frontend/app/profile/components/experience/ExperienceSection.tsx
  </files>
  <action>
**SortableItem.tsx** - Reusable drag-and-drop wrapper (shared across sections):
- Uses `useSortable` hook from @dnd-kit/sortable
- Renders a wrapper div with transform/transition styles from useSortable
- Exposes drag handle via `attributes` and `listeners` spread on a grip icon element
- Props: id (string), children (ReactNode), dragHandlePosition ("left" | "right", default "left")
- The grip icon (⋮⋮) uses `{...attributes} {...listeners}` to make only the handle draggable (not the whole card)
- Cursor changes to "grab" on handle hover, "grabbing" while dragging
- Subtle opacity reduction (0.5) on the dragged item
- Touch support enabled via PointerSensor (dnd-kit handles this automatically)

**SortableExperienceList.tsx** - Drag-and-drop container for experience cards:
- Uses DndContext + SortableContext from dnd-kit
- PointerSensor and KeyboardSensor for accessibility
- `verticalListSortingStrategy` for vertical reordering
- On `handleDragEnd`: compute new order, call `profileAPI.reorderSection('experience', newOrderItems)`, update local state optimistically
- Renders each ExperienceCard inside a SortableItem wrapper
- Pass experience data to cards as props

**ExperienceSection.tsx** - Top-level section component:
- Receives experiences array and refresh callback as props
- Section header: "Work Experience" with "+ Add Experience" button
- If no experiences: show empty state (briefcase icon, "No work experience yet", "Add your work history to showcase your professional journey", Add button)
- If has experiences: render SortableExperienceList
- Manages dialog state: which dialog is open (add/edit/delete), which experience is selected
- On add: open ExperienceFormDialog with no data
- On edit: open ExperienceFormDialog with selected experience data
- On delete: open DeleteConfirmDialog, on confirm call `profileAPI.deleteExperience(id)`, refresh list
- After any CRUD operation: call refresh callback to reload profile data from parent
  </action>
  <verify>
1. ExperienceSection renders empty state when no experiences
2. Add button opens form dialog
3. Saving new experience refreshes the list
4. Drag handle appears on experience cards
5. Dragging reorders cards and persists new order to backend
6. Delete shows confirmation and removes experience
7. All operations work without page reload (optimistic or callback-based updates)
  </verify>
  <done>
Complete Work Experience section with: summary cards, modal add/edit forms with bullet point management, drag-and-drop reordering for jobs, empty state, delete confirmation. SortableItem is reusable for other sections.
  </done>
</task>

</tasks>

<verification>
1. Experience section shows empty state when profile has no experiences
2. Add Experience opens modal, filling and saving creates a card
3. Edit opens modal with pre-filled data, saving updates the card
4. Bullet points can be added/removed in modal form
5. Experience cards can be reordered via drag-and-drop
6. Delete shows confirmation dialog, confirms removes the entry
7. All operations call correct backend API endpoints
</verification>

<success_criteria>
- ExperienceCard shows job title, company, dates, and truncated bullet points with expansion
- Modal form validates with Zod (required fields, date range logic)
- useFieldArray manages bullet points with correct React keys
- dnd-kit enables drag-and-drop reordering of cards and bullet points
- Delete confirmation prevents accidental deletion
- Empty state guides users to add their first experience
- SortableItem component is reusable for other sections
</success_criteria>

<output>
After completion, create `.planning/phases/03-master-profile-management/03-04-SUMMARY.md`
</output>
