---
phase: 02-authentication-security
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/app/dashboard/page.tsx
  - frontend/app/(auth)/login/page.tsx
  - backend/src/auth/auth.controller.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Dashboard displays user's first name and last name (not 'User' fallback)"
    - "Login page has no 'Remember Me' checkbox"
    - "All users get 7-day session by default (no 30-day extension)"
  artifacts:
    - path: "frontend/app/dashboard/page.tsx"
      provides: "Dashboard displays firstName + lastName properly"
      min_lines: 60
    - path: "frontend/app/(auth)/login/page.tsx"
      provides: "Login form without Remember Me checkbox"
      min_lines: 180
    - path: "backend/src/auth/auth.controller.ts"
      provides: "Login endpoint with 7-day default session only"
      min_lines: 250
  key_links:
    - from: "frontend/app/dashboard/page.tsx"
      to: "backend /auth/me"
      via: "authAPI.getMe() returns user with firstName and lastName"
      pattern: "firstName.*lastName"
    - from: "frontend/app/(auth)/login/page.tsx"
      to: "backend /auth/login"
      via: "authAPI.login() without rememberMe field"
      pattern: "authAPI\\.login"
---

<objective>
Fix UAT Gap 1: Display user's actual name on dashboard and remove "Remember Me" checkbox from login page.

Purpose: Resolve user feedback that dashboard shows generic "User" text instead of actual name, and simplify login flow by removing unnecessary "Remember Me" checkbox (all sessions default to 7 days).
Output: Dashboard shows "Welcome, [FirstName] [LastName]!" and login page has no Remember Me checkbox, with all users getting 7-day sessions.
</objective>

<execution_context>
@C:\Users\pc\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pc\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-authentication-security/02-authentication-security-UAT.md
@.planning/phases/02-authentication-security/02-07-SUMMARY.md
@frontend/app/dashboard/page.tsx
@frontend/app/(auth)/login/page.tsx
@backend/src/auth/auth.controller.ts
@backend/src/auth/strategies/session.serializer.ts
@backend/src/users/users.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix dashboard to display firstName + lastName instead of 'User' fallback</name>
  <files>frontend/app/dashboard/page.tsx</files>
  <action>
**Root cause analysis:**
- Current code line 64: `{user?.firstName || user?.name || 'User'}`
- Session serializer calls `UsersService.findById()` which DOES include firstName and lastName
- The fallback logic is working, but showing "User" suggests firstName is undefined/null in the returned user object
- Need to display full name: firstName + lastName

**Fix:**
Update the dashboard greeting to properly display user's full name:

```tsx
// Line 64 - Change from:
<p style={{ margin: '0 0 10px' }}>Welcome, <strong>{user?.firstName || user?.name || 'User'}</strong>!</p>

// To:
<p style={{ margin: '0 0 10px' }}>Welcome, <strong>{user?.firstName && user?.lastName ? `${user.firstName} ${user.lastName}` : user?.name || 'User'}</strong>!</p>
```

**Logic:**
1. If both firstName AND lastName exist: Display "FirstName LastName"
2. Else if name exists (OAuth users): Display name
3. Else: Display "User" (should rarely happen)

This ensures we show the full name (e.g., "Linda Ngwaluko") instead of just first name or falling back to "User".

**Also update the User interface to include lastName:**

```tsx
// Line 7-12 - Change from:
interface User {
  email: string;
  firstName?: string;
  name?: string;
  emailVerified?: boolean;
}

// To:
interface User {
  email: string;
  firstName?: string;
  lastName?: string;
  name?: string;
  emailVerified?: boolean;
}
```
  </action>
  <verify>
Run `cd frontend && npm run build` - should compile without TypeScript errors.
Check that User interface includes lastName field.
Check that welcome message uses firstName + lastName concatenation.
  </verify>
  <done>
Dashboard displays user's full name (firstName + lastName) in welcome message. User interface includes lastName field. Fallback logic properly handles cases where firstName/lastName exist vs OAuth name vs missing entirely.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove "Remember Me" checkbox from login page</name>
  <files>frontend/app/(auth)/login/page.tsx</files>
  <action>
**Root cause analysis:**
- User requested removal of "Remember Me" checkbox
- Current: 7-day default, 30-day with checkbox
- Requested: 7-day session for everyone (no checkbox)

**Fix:**
1. Remove rememberMe state from component (line 10)
2. Remove checkbox UI (lines 134-152)
3. Remove rememberMe from authAPI.login() call (line 21)

**Changes:**

```tsx
// Line 10 - REMOVE this line:
const [rememberMe, setRememberMe] = useState(false);

// Line 21 - Change from:
await authAPI.login({ email, password, rememberMe });

// To:
await authAPI.login({ email, password });

// Lines 134-152 - REMOVE entire checkbox section:
// DELETE from line 134 to 152 (the entire flex container with checkbox and forgot password link)
// KEEP only the forgot password link, restructure as:

<div style={{ textAlign: 'right', marginBottom: '20px' }}>
  <Link href="/reset-password" style={{ fontSize: '14px', color: '#0070f3', textDecoration: 'none' }}>
    Forgot password?
  </Link>
</div>
```

**Result:**
- No rememberMe state variable
- No checkbox in UI
- Login form only passes email and password to backend
- Forgot password link remains (right-aligned, above submit button)
  </action>
  <verify>
Run `cd frontend && npm run build` - should compile without errors.
Check that login page has no rememberMe state or checkbox.
Check that authAPI.login() call only passes email and password.
Check that "Forgot password?" link still exists.
  </verify>
  <done>
Login page has no "Remember Me" checkbox. Login form only sends email and password to backend. Forgot password link remains accessible (right-aligned above submit button). All users will get 7-day session by default.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update backend login endpoint to always use 7-day session (remove 30-day rememberMe logic)</name>
  <files>backend/src/auth/auth.controller.ts</files>
  <action>
**Root cause analysis:**
- Current: rememberMe extends cookie maxAge from 7 days to 30 days
- Requested: Everyone gets 7-day session (no 30-day extension)
- Backend currently expects rememberMe boolean and extends session if true

**Fix:**
Remove rememberMe logic from login endpoint:

```typescript
// Lines 74-81 - REMOVE rememberMe session flag and cookie extension:
// DELETE these lines:
        // Set rememberMe flag and createdAt for tracking
        (req.session as any).rememberMe = loginDto.rememberMe;
        (req.session as any).createdAt = Date.now();

        // Extend cookie maxAge for rememberMe
        if (loginDto.rememberMe) {
          req.session.cookie.maxAge = 30 * 24 * 60 * 60 * 1000; // 30 days
        }

// REPLACE with just createdAt tracking (for absolute expiry check):
        // Set createdAt for absolute session expiry tracking
        (req.session as any).createdAt = Date.now();
```

**Result:**
- All sessions use default 7-day duration (configured in session middleware)
- No rememberMe flag stored in session
- createdAt still tracked for absolute expiry enforcement (from 02-06-PLAN.md)
- LoginDto still accepts rememberMe field (for backward compatibility) but backend ignores it

**Note:** We keep LoginDto.rememberMe field to avoid breaking the DTO validation, but the backend simply doesn't use it anymore. This allows for graceful degradation if any client still sends it.

**Same fix applies to OAuth callbacks:**
In googleAuthCallback (line 213) and linkedinAuthCallback (line 244), remove any rememberMe logic if present. Both callbacks only set createdAt, which is correct - keep that.

**Verification after implementation:**
- Session cookie maxAge defaults to 7 days (controlled by session middleware config in 02-01-PLAN.md)
- No rememberMe flag in session object
- No conditional 30-day extension logic
  </action>
  <verify>
Run `cd backend && npm run build` - should compile without errors.
Check that login endpoint removes rememberMe session flag and cookie extension logic.
Check that only createdAt is set in session (for absolute expiry tracking).
Check that OAuth callbacks also don't set rememberMe.
  </verify>
  <done>
Backend login endpoint always creates 7-day sessions (no 30-day extension). rememberMe field removed from session object. Cookie maxAge defaults to 7 days for all users. createdAt still tracked for absolute session expiry enforcement. LoginDto.rememberMe field remains for backward compatibility but is ignored by backend.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Dashboard name display:**
   - Start dev environment: `npm run dev`
   - Login with test account: test@maxedcv.com / Test@1234
   - Dashboard should show: "Welcome, Sipho Ndlovu!" (or actual firstName + lastName from seed data)
   - NOT "Welcome, User!"

2. **Login page:**
   - Visit http://localhost:3000/login
   - Verify NO "Remember Me" checkbox visible
   - "Forgot password?" link still present (right-aligned)
   - Login form only has email and password fields

3. **Session duration:**
   - Login and verify session cookie in browser DevTools (Application -> Cookies)
   - Cookie `connect.sid` should have ~7 days maxAge
   - NOT 30 days

4. **End-to-end flow:**
   - Signup with new account (first name: "Linda", last name: "Ngwaluko")
   - Dashboard should show: "Welcome, Linda Ngwaluko!"
   - Logout and login again
   - Dashboard should still show: "Welcome, Linda Ngwaluko!"
</verification>

<success_criteria>
UAT Gap 1 fully resolved:
- Dashboard displays user's actual full name (firstName + lastName) instead of "User"
- Login page has no "Remember Me" checkbox
- All users get 7-day session by default (no 30-day extension logic)
- Session serializer properly returns firstName and lastName from database
- User can login and see their name immediately on dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication-security/02-08-SUMMARY.md`
</output>
